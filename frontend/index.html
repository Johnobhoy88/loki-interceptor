<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOKI FCA Control Center</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=12">
</head>
<body>
  <div class="shell" id="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand__icon">LK</div>
        <div class="brand__copy">
          <span class="brand__title">LOKI Interceptor</span>
          <span class="brand__subtitle">FCA Compliance Console</span>
        </div>
      </div>
      <nav class="nav">
        <button class="nav__item active" data-view="overview">
          <span class="nav__title">Command Centre</span>
          <span class="nav__desc">At-a-glance status & metrics</span>
        </button>
        <button class="nav__item" data-view="interceptor">
          <span class="nav__title">API Interceptor</span>
          <span class="nav__desc">Validate live AI outputs</span>
        </button>
        <button class="nav__item" data-view="validator">
          <span class="nav__title">Document Review</span>
          <span class="nav__desc">Scan disclosures & policies</span>
        </button>
        <button class="nav__item" data-view="analytics">
          <span class="nav__title">Analytics</span>
          <span class="nav__desc">Telemetry & breach trends</span>
        </button>
      </nav>
      <footer class="sidebar__footer">
        <div class="status">
          <span id="backend-status" class="status__pill">Checking connection…</span>
          <button id="refresh-status" class="status__refresh" type="button">Refresh</button>
        </div>
        <p class="sidebar__meta">Backend: loki-interceptor.vercel.app<br>Build: FCA Edition</p>
      </footer>
    </aside>

    <main class="content">
      <header class="topbar">
        <div>
          <h1>FCA Compliance Control Centre</h1>
          <p>Monitor and enforce the full FCA handbook across AI interactions, customer communications, and policy documents.</p>
        </div>
        <div class="topbar__actions">
          <div class="metric" id="metric-validated">
            <span class="metric__label">Validated</span>
            <span class="metric__value" id="stat-validated">0</span>
          </div>
          <div class="metric metric--warn" id="metric-warnings">
            <span class="metric__label">High Risk</span>
            <span class="metric__value" id="stat-warnings">0</span>
          </div>
          <div class="metric metric--critical" id="metric-blocked">
            <span class="metric__label">Critical</span>
            <span class="metric__value" id="stat-blocked">0</span>
          </div>
        </div>
      </header>

      <!-- Overview View -->
      <section class="view view--active" id="view-overview">
        <div class="grid grid--halves">
          <article class="card">
            <h2>Quick Actions</h2>
            <div class="quick-actions">
              <button class="qa" data-nav="interceptor">
                <span class="qa__title">Validate Prompt</span>
                <span class="qa__desc">Route an AI response through FCA checks.</span>
              </button>
              <button class="qa" data-nav="validator">
                <span class="qa__title">Assess Document</span>
                <span class="qa__desc">Upload or paste disclosures, policies, MI packs.</span>
              </button>
              <button class="qa" data-nav="analytics">
                <span class="qa__title">Review Analytics</span>
                <span class="qa__desc">Inspect breach trends, consumer duty metrics, SMCR logs.</span>
              </button>
            </div>
          </article>
          <article class="card">
            <h2>Activity Feed</h2>
            <div id="activity-feed" class="activity">
              <p class="empty">No activity yet. Run a validation to populate this feed.</p>
            </div>
          </article>
        </div>
        <article class="card">
          <h2>Module Coverage</h2>
          <div class="module-list" id="overview-modules"></div>
        </article>
      </section>

      <!-- Interceptor View -->
      <section class="view" id="view-interceptor">
        <div class="grid grid--halves">
          <article class="card">
            <header class="card__header">
              <div>
                <h2>Provider Configuration</h2>
                <p>Connect to your AI provider and choose which FCA packs to enforce.</p>
              </div>
            </header>
            <div class="form">
              <label class="field">
                <span>Provider</span>
                <select id="provider-select">
                  <option value="anthropic">Anthropic Claude</option>
                  <option value="openai">OpenAI GPT</option>
                  <option value="gemini">Google Gemini</option>
                </select>
              </label>
              <label class="field">
                <span>API Key</span>
                <input id="api-key-input" type="password" placeholder="sk-ant-..." autocomplete="off">
              </label>
              <button id="save-key-btn" class="btn" type="button">Save Credentials</button>
            </div>
          </article>
          <article class="card">
            <h2>Validation Scope</h2>
            <p>Select the FCA packs that should run for this session.</p>
            <div class="module-grid" id="modules-interceptor"></div>
          </article>
        </div>

        <article class="card">
          <header class="card__header">
            <div>
              <h2>Prompt Validation</h2>
              <p>Send a prompt to the provider; LOKI augments the response with FCA breach analysis.</p>
            </div>
            <button class="link" data-nav="analytics">View analytics & history →</button>
          </header>
          <label class="field">
            <span>Prompt</span>
            <textarea id="test-prompt" rows="8" placeholder="Enter a prompt, scenario, or conversation to evaluate..."></textarea>
          </label>
          <div class="actions">
            <button id="test-btn" class="btn btn--primary" type="button">Send &amp; Validate</button>
          </div>
          <div id="test-result" class="result result--hidden">
            <div id="result-content"></div>
          </div>
        </article>
      </section>

      <!-- Validator View -->
      <section class="view" id="view-validator">
        <article class="card">
          <header class="card__header">
            <div>
              <h2>Document Validation</h2>
              <p>Paste customer communications, policy docs, MI packs or SMCR artefacts for FCA scrutiny.</p>
            </div>
          </header>
          <div>
            <span class="field-label">Validation Packs</span>
            <div class="module-grid" id="modules-validator"></div>
          </div>
          <label class="field">
            <span>Document Text</span>
            <textarea id="doc-text" rows="14" placeholder="Paste the document content here for review…"></textarea>
          </label>
          <div class="actions">
            <button id="validate-btn" class="btn btn--primary" type="button">Validate Document</button>
          </div>
          <div id="validation-result" class="result result--hidden">
            <div id="validation-content"></div>
          </div>
        </article>
      </section>

      <!-- Analytics View -->
      <section class="view" id="view-analytics">
        <div class="analytics-header">
          <h2>Analytics &amp; Telemetry</h2>
          <label class="field field--inline">
            <span>Window</span>
            <select id="analytics-window">
              <option value="7">7 days</option>
              <option value="14">14 days</option>
              <option value="30" selected>30 days</option>
              <option value="90">90 days</option>
            </select>
          </label>
        </div>
        <div class="analytics-grid">
          <article class="card">
            <h3>Risk Overview</h3>
            <div id="analytics-overview" class="stats-grid"></div>
          </article>
          <article class="card">
            <h3>Risk Trends</h3>
            <div id="analytics-trends" class="trend-grid"></div>
          </article>
          <article class="card">
            <h3>Universal Alerts</h3>
            <div id="analytics-universal" class="list"></div>
          </article>
          <article class="card">
            <h3>Module Performance</h3>
            <div id="analytics-modules" class="list"></div>
          </article>
          <article class="card card--full">
            <h3>Recent Activity</h3>
            <div id="analytics-recent" class="list"></div>
          </article>
        </div>
      </section>
    </main>
  </div>
  <div class="toast-container" id="toast-container"></div>
  <script src="app.js?v=16" type="module"></script>
</body>
</html>
